---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  dpi = 300
)
```
[![lifecycle](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
[![Travis build status](https://travis-ci.org/poissonconsulting/fwabc.svg?branch=master)](https://travis-ci.org/poissonconsulting/fwabc)
[![AppVeyor build status](https://ci.appveyor.com/api/projects/status/github/poissonconsulting/fwabc?branch=master&svg=true)](https://ci.appveyor.com/project/poissonconsulting/fwabc)
[![Coverage status](https://codecov.io/gh/poissonconsulting/fwabc/branch/master/graph/badge.svg)](https://codecov.io/github/poissonconsulting/fwabc?branch=master)
[![License: MIT](https://img.shields.io/badge/License-MIT-green.svg)](https://opensource.org/licenses/MIT)

# fwabc

`fwabc` is an R package to read subsets of data from various layers in the BC Freshwater Atlas.
Currently, the package supports retrieving streams, watersheds, watershed groups, and coastline.  

We simplify working with the databases by:  

+ Writing SQL queries required to read only a subset of a layer prior to loading into memory.  

+ Matching regular expressions (e.g. "columbia|koot") to GNIS_NAME, BLUE_LINE_KEY and FWA_WATERSHED_CODE.  

+ Parsing FWA_WATERSHED_CODE to get all tributaries of a particular feature in the network.  


Let's take a look at two of my neighbourhoud streams, whose official GNIS names are Sangan River and Hiellen River.
```{r stream}
library(fwabc)
library(ggplot2)
library(sf)

streams <- fwa_stream("sangan|hiellen")
```

Notice that `fwa_stream()` takes a regular expression to internally search for matching GNIS names.  It is useful to check which streams we have included.
```{r stream search}
fwa_search_gnis("sangan|hiellen")
```

Now let's get all of the tributaries and plot.
```{r stream tribs, fig.width = 5, fig.height = 3}
tribs <- fwa_stream("sangan|hiellen", tributaries = TRUE)

ggplot() +
  geom_sf(data = tribs, color = "black", size = 0.2) +
  geom_sf(data = streams, color = "steelblue", size = 0.5) 

```

Finally let's get the watershed polygons and coastline for Graham Island.
```{r stream map, fig.width = 6, fig.height = 5}
wshed <- fwa_watershed("sangan|hiellen", tributaries = TRUE) %>% 
  sf::st_union()

coastline <- fwa_coastline("Graham Island")

bbox <- sf::st_bbox(sf::st_buffer(wshed, 8000))

ggplot() +
  geom_sf(data = coastline, size = 0.3, color = "black") +
  geom_sf(data = wshed, fill = "white", size = 0.4, color = "black") +
  geom_sf(data = tribs, size = 0.1, color = "black") +
  geom_sf(data = streams, size = 0.5, color = "steelblue") +
  coord_sf(xlim = c(bbox[1], bbox[3]), ylim = c(bbox[2], bbox[4]))

```

## Installation

To install the latest development version from [GitHub](https://github.com/poissonconsulting/fwabc)
```
install.packages("devtools")
devtools::install_github("poissonconsulting/fwabc")
```

To install the latest development version from the Poisson drat [repository](https://github.com/poissonconsulting/drat)
```
install.packages("drat")
drat::addRepo("poissonconsulting")
install.packages("fwabc")
```

## Contribution

Please report any [issues](https://github.com/poissonconsulting/fwabc/issues).

[Pull requests](https://github.com/poissonconsulting/fwabc/pulls) are always welcome.

Please note that this project is released with a [Contributor Code of Conduct](CONDUCT.md). 
By participating in this project you agree to abide by its terms
